;;; -*- Lisp -*-
(load "script-support")
(load-asdf)
(in-package :asdf)

(defparameter *test-directory*
  (merge-pathnames*
    (make-pathname :directory '(:relative "tmp"))
    cl-user::*asdf-directory*))

(defun under-test-directory (designator &optional (defaults *test-directory*))
  (namestring (merge-pathnames* (merge-component-name-type designator) defaults)))

(defun create-conf-files (&optional (path *test-directory*))
  (let ((v `(("conf.d/conf1.conf"
              ((:directory ,(under-test-directory "dir1/"))))
             ("conf.d/conf2.conf"
              ((:tree ,(under-test-directory "dir2/")))))))
    (loop
      :for (file contents) :in v
      :for name = (under-test-directory file path)
      :do
      (ensure-directories-exist name)
      (with-open-file (out name
                           :direction :output
                           :if-exists :supersede)
        (with-standard-io-syntax
          (format out "誉泔铘孱趔┅┅┅ㄤ彐疳蜥礤翦翦篝狍洵溟蝈泗矧殄螵祜镳烘矧溟洪Ж溟虮溟虿溟虺溟虿溟虼溟虿恒镬戾泗躅溴颦翦篝溟蝈泗矧溟颟┅ㄤ彐躅泸遽翦狍洵骈戾ī祜镳烘矧洪翦篝狍洵溟蝈泗矧殄螵烘矧烘蝻轰ㄥ铙躜瀛溟蝈泗矧殄蟓屮轶洎鏖翳镳孱骈戾礤蜱瀛疳翳钺礤螵ㄦ矧磲铋㈡镲漠狍洧椹洎轰轵邈糸镱猴豸瘐洪姝屮轶趔候孱犴瀛犷洵溴戾翦洪姝滹弩铒舡屮轶恒蝈狒濠ㄦ矧磲ㄡ箐婧溴骟篝屙烘镲末ア椹┅ㄣ飙躞弪汉聃轸镱弪蝻ㄡ篌弪ㄥ聃犰疳蝮瀛秕麴豸趄犷箪狒轱铙篝蜷铉骘锖忉蚝函忉函聃貘Ж猴豸瘐舡趄犷箪狒轱铙á骘铫忉颌洪铊弪轸泔铈殓躜狒轱á忉聃貘┅┅ㄡ篌弪ㄥ聃犰疳蝮瀛秕麴豸趄犷箪狒轱铙篝蜷铉孩Ж猴豸瘐舡趄犷箪狒轱铙á铋飑洪珙矧瀛轭桢蜷翦洵泔铈殓躜狒轱瞟┅ㄡ篌弪ㄥ聃犰疳蝮瀛秕麴豸趄犷箪狒轱铙篝蜷铉汉Ж猴豸瘐舡趄犷箪狒轱铙á铋飑洪铊弪轸泔铈殓躜狒轱瞟┅ㄡ篌弪ㄥ聃犰疳蝮瀛秕麴豸趄犷箪狒轱铙篝蜷铉函Ж猴豸瘐舡趄犷箪狒轱铙á洪珙矧瀛轭桢蜷翦洵泔铈殓躜狒轱瞟┅ㄡ篌弪ㄥ聃犰疳蝮瀛秕麴豸趄犷箪狒轱铙篝蜷铉ê秕麴豸趄犷箪狒轱铙ㄜ堍堍堍洪珙矧瀛轭桢蜷翦洵泔铈殓躜狒轱瞟Ж猴豸瘐舡趄犷箪狒轱铙á洪珙矧瀛轭桢蜷翦洵泔铈殓躜狒轱瞟┅ㄣ蝈狒瀛狍洵骈戾螬ㄣ蝈狒瀛泔铈骈戾螬ㄩ铋糸犰辁瀛箫躜沐蝈玳篝蝙啜后秕蜚瀛蝈玳篝蝙ê轭沆蹁躅溴颦翦篝溟蝈泗矧泔铈浏┅洪珙矧瀛轭桢蜷翦洵泔铈殓躜狒轱瞟ㄡ篌弪ㄥ聃犰钺礤篝蜷铉簌篝屙蝈灬糸鲥疳翳钺礤烘镲⑩狎忉扉箴┅躅溴颦翦篝溟蝈泗矧溟虿忉虔忉扉箴┅