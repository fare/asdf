;;; -*- Lisp -*-
(load "script-support")
(load-asdf)

;;;---------------------------------------------------------------------------
;;; Here's what we are trying to test.  Let us say we have a system X that
;;; contains a file, "file1" and a module, "quux" that depends on file 1.  In
;;; turn, "quux" contains "file2" which depends on loading another system, Y
;;; (note that this dependency cannot be recorded using only the defsystem
;;; grammar; we must use an ancillary method definition).  If we over-force
;;; actions, then the recompiling of "file1" will force "quux" to be loaded,
;;; forcing "file2" load and in turn forcing the reload and recompilation of Y.
;;; If operations are done properly, a change to file1 will force recompilation
;;; and reloading of "file2," but /not/ of system Y.
;;;---------------------------------------------------------------------------


(quit-on-error
 (setf asdf:*central-registry* '(*default-pathname-defaults*))
 (asdf:operate 'asdf:load-op 'test-module-excessive-depend)

 ;; test that it compiled
 (defvar file1-date (file-write-date (asdf:compile-file-pathname* "file1")))
 (defvar file2-date (file-write-date (asdf:compile-file-pathname* "file2")))
 (defvar file3-date (file-write-date (asdf:compile-file-pathname* "file3")))

 (unless (and file1-date file2-date file3-date)
   (error "Failed to compile one of the three files that should be compiled for this test: 狺磲疸狎＇沅蝈盹鲥殒＇汜疳轵扉扉篝骈戾杯溽翦骈戾箔溽翦骈戾抄溽翦Ж㈡殪灞㈡殪宀㈡殪宄┅┅┅换犷祜徜邃ㄡ篌弪ㄥ鲠ㄩ铘弪簌礅镬钺礤В邯骈戾豹呼弩舡疳汶徵濠┅ㄡ篌弪ㄥ鲠ㄩ铘弪簌礅镬钺礤В邯骈戾唱呼弩舡疳汶徵濠┅换铒麸蹉骈戾犷汨邈翳狒骈戾唛筮犰箫蝈泔眇殪邃换怩翳狒骈戾轶哳雉蝈泔眇殪邃换翳轶鏖祆镱禊黠螂殒翳泸矬蟓盹漉戾ㄩ铘蜥簌篝屙换溴疱钿孱泫怩轶骈邃犷翳屮沐篌轹泔眇殪狒轱怩轶骈邃戾è忮骘蝈骈戾箔溽翦┅ㄡ箐婧候躅箬屐飙泔眄犷Ⅳ秕汨骈戾碑扉箴箪邋暴戾è痨犷ㄡ箐婧呼蜥鲥蝮磲脲轭篝犷沐п箐婧祜徜镳ㄡ箐婧骈钿簌篝屙翦篝盹漉戾屮沐篌轹瀛溴疱钿┅ㄦ殪宄镱禊ㄡ箐婧骈钿簌篝屙ф殪宄镱禊┅换ㄦ矧磲ハ疱蜥糸镱痨犷轶湖ア换痧蜷铘痨犷换ㄦ矧磲⒃狎珏簌篝屙轶幄骈戾抄镱禊麒孱ㄦ轭骈戾抄镱禊痨犷弘妁＇沅颟ㄥ蝌矧⑴沐篌轹镳弪狒轱铙镱骈戾抄镱禊簌篝屙箩痱镳徵狒轱镦溴疱钿孱汩弩┅ㄡ箐婧镳弪狒п箐婧祜徜镳翦篝盹漉戾溴疱钿ㄡ篌弪ㄦ殪瀛黩轸瀛溽翦ㄡ箐婧泔眇殪瀛骈戾疳翳钺礤㈡殪宀┅忮骘蝈┅ㄡ篌弪ㄦ殪瀛黩轸瀛溽翦ㄡ箐婧泔眇殪瀛骈戾疳翳钺礤㈡殪宀┅忮骘蝈┅躅戾篌ㄦ殪瀛黩轸瀛溽翦ㄡ箐婧泔眇殪瀛骈戾疳翳钺礤㈡殪宄┅骈戾抄溽翦ㄥ蝌矧⑴沐篌轹泔眇殪狒轱镦骈戾钞扉箴趄狯弪箦怩绠┅